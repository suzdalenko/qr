<!DOCTYPE html>
<html foxified=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> 
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ESCANEAR TABLET</title>
   
    <meta name="theme-color" content="#ffffff">
    <link rel="manifest" href="/qr/manifest.json">
    
    <link rel="icon" type="image/png" href="./ESCANEAR TABLET_files/logo2.png">
    <link href="./ESCANEAR TABLET_files/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="./ESCANEAR TABLET_files/main2.css" rel="stylesheet">
    <link rel="stylesheet" href="./ESCANEAR TABLET_files/custom.css">    
</head>
<body cz-shortcut-listen="true">
    <div>
        <a class="title" href="/qr">
            <img class="img_logo_froxa" src="./ESCANEAR TABLET_files/logo2.png">
            <h1 class="h1_title_page" id="h1_title_id">COMPROBAR DATOS</h1>
        </a>
    </div>
       
    <div>
        <div class="container-fluid">
            <div class="text-center">
                <div id="app" data-v-app=""><span style="display: none;"></span><div class="text_align_center"><h6>TABLET: POTA ENTERA NZ L 400/600</h6><input type="text" id="input_qr_focus" placeholder=" ESCANEAR PALETA" style="display: none;"><!-- recepcionar_paleta_almacen_fabrica____111 --></div><div style=""><table><tbody><tr><td class="allrigth">ARTÍCULO PALETA:</td> <td class="allleft">POTA ENTERA NZ L 400/600</td></tr><tr><td></td><td class="allleft"><input type="number" class="input_numbrer" id="input_id_kilos"> kg<br><input type="number" class="input_numbrer" id="input_id_cajas"> cajas</td></tr><tr><td class="allrigth">CANTIDAD:</td> <td class="allleft">444 kg</td></tr><tr><td class="allrigth">LOTE:</td> <td class="allleft">N1204</td></tr><tr><td class="allrigth">FECHA CAD:</td> <td class="allleft">2222-11-01</td></tr></tbody></table><br><div><button class="button_pal cancelado">CANCELAR</button><button class="button_pal aceptado">ACEPTAR</button></div></div> ingredienteOf__id: 224194 <br> ultimo__qr: xxxxxxxxxxxxxxxxxxxxxxxxx <br> miQR__articulo__id: 2721 <br> ingrediente: {
  "id": 224194,
  "__articulo__id": 2721,
  "__articulo____erp": "402200120",
  "__articulo____descripcion": "POTA ENTERA NZ L 400/600",
  "__cantidad": "1500.0000",
  "__cantidaddevuelta": "0.0000",
  "__cantidaddevuelta__carretillero": null,
  "__cantidaddevuelta__planta": null,
  "__cantidaddevuelta__agrupada": null,
  "__cantidadreal": "1080.0000",
  "__cantidadrecibida": "1080.0000",
  "__factor": "1.0000",
  "__formula": "consumo",
  "__ingrediente__id": 9243,
  "__ordenfabricacion__id": 25740,
  "__ordenfabricacion____erp": "1004828",
  "__ordenfabricacion____fechainicioprevista": "2022-12-15",
  "__preciocoste": "3.8825",
  "__preciobase": "3.8825",
  "__preciodescuento": "0.0000",
  "__importeingrediente": null,
  "__divisionimporteingrediente": null,
  "__receta__id": 957,
  "__receta____erp": "500122401",
  "__stock": "122093.0021",
  "__ultimolote": "DIS199",
  "__ultimacaducidad": "2024-05-05",
  "__estadopeticion": "recepcionado",
  "__estadodevolucion": null,
  "__zona__id": 1,
  "__zona____descripcion": "Descongelacion",
  "__state": "activo",
  "created_at": "2022-12-14 10:25:07",
  "updated_at": "2022-12-15 10:20:14"
} <br> paleta: {
  "__sscc": "384108090002317635",
  "__ean": "8410809003638",
  "__lote": "N1204",
  "__cantidad": "444",
  "__fecha": "2222-11-01",
  "__descripcion": "POTA ENTERA NZ L 400/600"
} <br> current__action: 2 - entrada con QR de almacen a produccion <br></div>
<script>
    const { createApp } = Vue
    createApp({
        data() {
            return {
                ingredienteOf__id     : null,
                escanear_tablet_paleta: true,
                current_action        : ' ESCANEAR TABLET',
                input__qr             : '',
                articulo__qr__creado  : '',
                mostrar_table_actions : false,
                
                INGREDIENTEOF__OBJ    : {},
                PALETA__ART           : {},
                paleta__kilos         : '',
                paleta__cajas         : '',

                ultimo__qr            : '',
                miQR__articulo__id    : null,
                show_input_qr         : true,  
                current__action       : null,
                botonAceptarClicked   : false
            }
        },
        created(){
           
        },
        computed:{
            inputEscaneado(){ 
                this.botonAceptarClicked = false
                let inputQrCodeText      = this.input__qr.trim()
                this.ultimo__qr          = inputQrCodeText
                this.input__qr           = '' 

                /* 
                    escaneando qr creado por mi:
                                                                    "__articulo__id":2721                    
                        2 - entrada con QR de almacen a produccion (2_______224194ssssssss 2_______224011ssssssss 2_______224194ssssssss) 

                */
                if(inputQrCodeText.includes('_______') && inputQrCodeText.length == 22){ 
                    let arrayCodeText      = inputQrCodeText.split('_______')
                    let codeAccion         = parseInt(arrayCodeText[0])
                    this.ingredienteOf__id = arrayCodeText[1].split('s').join('')
                    
                    if( parseInt(this.ingredienteOf__id) > 1 && (codeAccion == 2)){      
                        switch(codeAccion){
                            case 2: 
                                this.current__action = '2 - entrada con QR de almacen a produccion'
                                break
                        }
                        this.TraerArticuloMiQrIngrediente(this.ingredienteOf__id) // la tablet me pide tal articulo
                    } else {
                        alert('CÓDIGO QR TABLET NO VÁLIDO'); window.location.reload()
                    }
                /*
                    escaneado paleta real en la fabrica xxxxxxxxxxxxxxxxxxxxxxxxx
                */
                } else if (!inputQrCodeText.includes('_______') && inputQrCodeText.length > 22) { 
                    let qrObj = this.ParseQrPaleta(inputQrCodeText)
                    this.TraerArticuloPaletaEntregaCamarista(qrObj)
                    
                } else if (inputQrCodeText) {
                    alert('CÓDIGO QR NO VÁLIDO: ' + inputQrCodeText)
                }
                return this.input__qr
            }  
        },
        mounted(){
            this.SetImputFocus()    
            var input_id_kilos = document.getElementById('input_id_kilos')
            var input_id_cajas = document.getElementById('input_id_cajas')
                input_id_kilos.addEventListener('input', () => {
                    input_id_kilos.value && input_id_cajas.value ? this.PALETA__ART.__cantidad = input_id_kilos.value * input_id_cajas.value: console.log('none')  
                })
                input_id_cajas.addEventListener('input', () => {
                    input_id_kilos.value && input_id_cajas.value ? this.PALETA__ART.__cantidad = input_id_kilos.value * input_id_cajas.value: console.log('none')     
                })
        },
        methods:{
            SetImputFocus(){
                setTimeout(()=>{ document.getElementById('input_qr_focus').focus() }, 1000)
            },
            TraerArticuloMiQrIngrediente(ingredienteOf__id){ 
                let AppContextS0 = this
                fetch(window.location.origin + '/backendproduccion/public/index.php/api/current__ingredienteof/'+ingredienteOf__id).then(res => res.json()).then(ingredienteOf => {
                            if(ingredienteOf && ingredienteOf.id == ingredienteOf__id && ingredienteOf.__articulo__id && ingredienteOf.__ordenfabricacion__id){
                                AppContextS0.INGREDIENTEOF__OBJ                   = ingredienteOf
                                AppContextS0.articulo__qr__creado                 = 'TABLET: '+ingredienteOf.__articulo____descripcion
                                document.getElementById('h1_title_id').innerText  = ' ESCANEAR PALETA'
                                AppContextS0.current_action                       = ' ESCANEAR PALETA'
                                AppContextS0.miQR__articulo__id                   = ingredienteOf.__articulo__id
                                AppContextS0.SetImputFocus()
                                
                            } else {
                                alert('INGREDIENTE NO ENCOTRADO'); window.location.reload()
                            }
                        }).catch(error => {alert('ERROR ESCANER INGREDIENTE QR ' + error); window.location.reload()})
            },
            ParseQrPaleta(__qr__){
                return {__sscc:'384108090002317635', __ean: '8410809003638', __lote:'N1204', __cantidad: '444', __fecha: '2222-11-01'}
            },
            TraerArticuloPaletaEntregaCamarista(qrObj){
                let AppContextS1 = this
                fetch(window.location.origin + '/backendproduccion/public/index.php/api/get_articulo_from_ean/'+qrObj.__ean).then(res => res.json()).then(paletaArt => {
                        if(paletaArt && paletaArt.id == AppContextS1.INGREDIENTEOF__OBJ.__articulo__id && paletaArt.__descripcion && paletaArt.id){
                            // el mismo articulo entre 2 qr
                            AppContextS1.show_input_qr                        = false
                            AppContextS1.mostrar_table_actions                = true
                            AppContextS1.PALETA__ART                          = qrObj
                            AppContextS1.PALETA__ART.__descripcion            = paletaArt.__descripcion
                            document.getElementById('h1_title_id').innerText  = 'COMPROBAR DATOS'
                            
                        } else {
                            alert('PALETA NO VALIDA \n ES DE OTRO ARTÍCULO QUE INDICADO EN EL QR TABLET \n '+AppContextS1.articulo__qr__creado+' \n PALETA '+paletaArt.__descripcion)
                        }
                    }).catch(error => alert('ERROR Al BUSCAR ARTÍCULO PALETA'))
            },
            //    CaducidadFormateada:function () {
            //        return '20' + this.PALETA__ART.__fecha.substr(4, 2) + '-' + this.PALETA__ART.__fecha.substr(2, 2) + '-' + this.PALETA__ART.__fecha.substr(0, 2);
            //    },
            CancelPage(){
                window.location.reload()
            },
            AcceptPage(){
                if(!((input_id_kilos.value && input_id_cajas.value) || (!input_id_kilos.value && !input_id_cajas.value))) return
                let thisAppContext3 = this
                if(this.botonAceptarClicked) return
                this.botonAceptarClicked = true
                if(!this.PALETA__ART.__cantidad || this.PALETA__ART.__cantidad < 1) { this.botonAceptarClicked = false; alert('Cantidad obligatoria'); return }
                
                if(this.current__action == '2 - entrada con QR de almacen a produccion'){
                    let formData = new FormData()
                        formData.append('__sscc',            this.PALETA__ART.__sscc)
                        formData.append('__ean',             this.PALETA__ART.__ean)
                        formData.append('__lote',            this.PALETA__ART.__lote)
                        formData.append('__cantidad',        this.PALETA__ART.__cantidad)
                        formData.append('__ingrediente__id', this.ingredienteOf__id)
                        formData.append('__fecha',           this.PALETA__ART.__fecha)

                    fetch(window.location.origin + '/backendproduccion/public/index.php/api/entrada_con_QR_de_almacen_a_produccion', {method:'POST', body: formData}).then(r => r.json()).then(result => {
                        if(result && result.status == 200){ 
                            Swal.fire({ title: 'Paleta recepcionada', text : '', icon : 'success', confirmButtonText: 'Continuar' }).then(res => window.location.reload())
                        } else {
                            Swal.fire({ title: 'No se encuentra el parte', text : '', icon : 'error', confirmButtonText: 'Continuar' })
                        }
                        thisAppContext3.botonAceptarClicked = false
                    }).catch(error => {alert('ERROR recepcionar paleta ' + error); window.location.reload()})
                }

                
            }
        },
        delimiters: ["{@", "@}"],
    }).mount('#app')

  </script>

<style>
    section{
        text-align: center;
    }
    .page_title{
        margin-top: 111px;
    }
    #escanear_tablet_div, #escanear_paleta_div, #articulo_ingrediente{
        display: none; 
    }
    input{
        border: 1px solid rgb(145, 145, 251);
        width: 171px;
        display: inline-block;
    }
    table, th, td {
       font-size: 19px;
    }
    table{
        margin-left: 1%; width: 98%; 
    }
    body{
       font-weight: 700;
    }
   
    .text_align_center{
        text-align: center;
    }
    #escanear_tablet_div, #page_title, #escanear_paleta_div, #input_qr_code_tablet, #input_qr_code_paleta, .text_align_center{
        margin-top: 1px;
    }
    .allleft  { text-align: left;  width: 50%; }
    .allrigth { text-align: right; width: 50%; }
    td{
        padding: 2px;
    }
    .button_pal{
        border: 0;
        padding: 11px;
        margin-left: 11px;
        margin-right: 11px;
        border-radius: 7px;
    }
    .cancelado{
        background-color: #899b9d;
        color: white;
    }
    .cancelado:hover{
        background-color: #595959;
    }
    .aceptado{
        background-color: #5a729f;
        color: white;
    }
    .aceptado:hover{
        background-color: #476193;
    }
    .input_numbrer{
        width: 70px;
    }
    #input_qr_focus{
        text-align: center;
    }
    h6{
        font-weight: 900;
        font-size: 17px;
        color: black;
    }
</style>


<script>

</script>


<!--
   sscc                  ean   
   18                 02  13  
   384108090002317635    08410809003638                 210630 N512100176    742 
00 384108090002317635 02 08410809003638 3102######## 15 210630 N512100176 37 742




// '(02)08410809003638(3102)########(15)210630(10)N512100176(37)742'
                // '(3102)#######(15)210630(10)N5121001176(37)945'
                //  0038410809000231763502084108090036383102
                //  0038410809000231763502084108090036383102########15210630N51210017637742

    let formData = new FormData(); formData.append('qr', inputQrCodeText);
       fetch(window.location.origin + '/backendproduccion/public/index.php/api/save_this_qr', { method: 'POST', body: formData })
       alert(inputQrCodeText)
-->            </div>
        </div>
    </div>

    <style>
        .title {
          background-color: #172f5b;
          display: block;
          width: 100%;
        }
        .title h1 {
          display: inline-block;
          vertical-align: middle;
        }
        .title .img_logo_froxa {
          width: 55px;
          height: 45px;
          display: inline-block;
          vertical-align: middle;
        }
        .h1_title_page{
            font-size: 25px;
            color: white;
            font-weight: 700;
        }
    </style>

<script>(() => {
        window.addoncropExtensions = window.addoncropExtensions || [];
        window.addoncropExtensions.push({
            mode: 'emulator',
            emulator: 'Foxified',
            extension: {
                id: 44,
                name: 'Descargar videos de Youtube y MP3',
                version: '17.2.8',
                date: 'November 26, 2022',
            },
            flixmateConnected: false,
        });
    })();</script></body></html>
